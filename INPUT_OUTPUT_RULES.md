# CareMap Input → Output Rules (v1.0)

This document defines the **deterministic transformation rules** used to convert raw health inputs into the CareMap one-page Caregiver Fridge Sheet.

These rules exist to ensure:
- safety over completeness
- clarity over clinical precision
- consistency across outputs
- testability and auditability

CareMap is designed to **fail closed**: when data is missing or uncertain, the system produces less output rather than speculative or unsafe output.

---

## 1. Accepted Inputs

CareMap accepts **partial and imperfect data**. All inputs are optional.

### 1.1 Structured Inputs (Preferred)
- **Medications**
  - medication name
  - timing (if available)
  - clinician note (optional)
- **Conditions**
  - chronic conditions list (plain or clinical terms)
- **Labs / Tests**
  - test name
  - qualitative flag (normal / high / low) if available
- **Care gaps**
  - overdue screenings
  - pending labs
  - follow-up needed
- **Contacts**
  - primary clinic name + phone
  - pharmacy name + phone

### 1.2 Unstructured Inputs (Optional)
- EHR notes
- patient portal text
- discharge instructions

**Rule:**  
Unstructured inputs must be parsed and normalized before being used downstream.

---

## 2. Normalization Rules (Pre-Processing)

Normalization occurs **before any MedGemma usage**.

### 2.1 PHI Removal
The following must be removed if present:
- full names (beyond first name or nickname)
- date of birth
- medical record numbers
- insurance identifiers
- addresses
- provider names (except clinic contact)

If removal is ambiguous → drop the field.

---

### 2.2 Language Normalization
- Replace clinical terms with plain language:
  - hypertension → high blood pressure
  - hyperlipidemia → high cholesterol
  - renal insufficiency → kidney issues
- Remove acronyms unless universally understood
- Target reading level ≈ 6th grade

---

### 2.3 Medication Normalization
- Deduplicate by medication name
- Collapse brand ↔ generic names
- Cap list at **8 medications**
- If more than 8 are present:
  - prioritize life-sustaining and safety-critical medications
  - deprioritize supplements and PRN items

---

### 2.4 Time Normalization
- Convert absolute dates to relative time buckets:
  - today
  - this week
  - later
- Do not surface calendar dates on the fridge sheet

---

## 3. Section-by-Section Mapping Rules

---

### Section 1 — Care Snapshot

**Inputs used**
- age (optional)
- conditions list

**Rules**
- Include max **3** conditions
- Conditions must be chronic and caregiver-relevant
- No inference if conditions are missing
- Use plain language only

---

### Section 2 — Medications (What / Why / When)

**Inputs used**
- medication list
- clinician notes (if present)

**Mapping**
For each medication:
- **Medication:** normalized name
- **Why it matters:** generated by MedGemma  
  - one sentence
  - plain language
  - explains purpose, not mechanism
- **When to give:**  
  - use provided timing if present  
  - otherwise show **“As prescribed”**
- **Important note:**  
  - selected from known safety patterns or clinician notes  
  - one sentence maximum

**Forbidden**
- dosage calculations
- treatment recommendations
- medication changes
- speculative interaction warnings

---

### Section 3 — CareMap Actions (Today / This Week / Later)

**Inputs used**
- care gaps
- follow-up instructions
- daily medication actions

**Mapping**
- Assign actions to time buckets:
  - **Today:** safety-critical or daily actions
  - **This Week:** scheduling, labs, follow-ups
  - **Later:** preventive or future actions

**Rules**
- Max 2 actions for Today and This Week
- Max 1 action for Later
- Each action must begin with a verb
- No informational-only items allowed

---

### Section 4 — Things Still Pending

**Inputs used**
- care gaps list

**Mapping**
Each item must be rewritten as:
- plain-language description
- followed by a clear next step (Call / Schedule / Ask)

Example:
- “Diabetic retinopathy screening overdue”
→ “Eye exam overdue → Call clinic”

---

### Section 5 — Lab & Test Insights

**Inputs used**
- lab/test names
- qualitative flags (if available)

**Mapping**
MedGemma may generate:
- high-level meaning (normal / slightly off / needs follow-up)
- one caregiver-appropriate question

**Rules**
- Max 3 lab insights
- No numeric values or reference ranges
- No urgency escalation unless explicitly stated in input
- Use uncertainty-aware language

---

### Section 6 — When to Call for Help

**Inputs used**
- clinic contact
- pharmacy contact

**Rules**
- Contacts copied verbatim if present; otherwise “Not available”
- Escalation list is **fixed and static**:
  - chest pain
  - confusion
  - fainting
- No model-generated emergency logic

---

### Section 7 — Safety Reminders

**Inputs used**
- none

**Rules**
- Static content only
- Must always be included
- Never altered or regenerated

---

## 4. MedGemma Usage Rules

MedGemma is used **only** for:
- translating medical concepts to plain language
- summarizing medication purpose
- generating high-level lab explanations
- adapting tone to caregiver-friendly language

MedGemma must not:
- diagnose conditions
- recommend treatment changes
- adjust medications or dosages
- infer missing data
- escalate urgency

If uncertainty is detected, MedGemma must defer:
> “Please confirm this with the clinician.”

---

## 5. Fail-Closed Safety Rules

If any generated output includes:
- diagnosis language
- dosage advice
- medication changes
- urgency classification beyond fixed rules

Then:
- remove the content
- replace with neutral deferral language
- prefer omission over risky output

---

## 6. One-Page Enforcement

Before final output:
- enforce section limits (meds, labs, actions)
- truncate excess items deterministically
- ensure printable single-page layout

Multi-page output is never allowed.

---

These rules define the **non-negotiable behavior** of CareMap v1.0.
